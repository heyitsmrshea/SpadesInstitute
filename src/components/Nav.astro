---
import MenuIcon from './icons/MenuIcon.astro';
const base = import.meta.env.BASE_URL.replace(/\/$/, '');

// Main nav links (excluding Partner which is now a CTA)
const navLinks = [
  { label: 'Home', href: `${base}/` },
  { label: 'About', href: `${base}/about` },
  { label: 'Engage', href: `${base}/engagements` },
  { label: 'People', href: `${base}/people` },
  { label: 'Briefings', href: `${base}/blog` }
];

const pathname = Astro.url.pathname.replace(/\/$/, '') || '/';
const isActive = (href) => {
  const normalizedHref = href.replace(/\/$/, '') || '/';
  const normalizedPath = pathname || '/';
  return normalizedPath === normalizedHref || 
         (normalizedHref !== '/' && normalizedPath.startsWith(normalizedHref));
};
---
<header class="w-full sticky top-0 z-40 border-b border-white/10" style="background-color: #0a0f1c;">
  <div class="max-w-5xl mx-auto px-6 py-3 flex items-center justify-between gap-6">
    <!-- Logo -->
    <a 
      class="nav-link flex items-center text-white hover:text-white/90 transition-colors focus-white rounded group" 
      href={`${base}/`}
      aria-label="Spades Institute Home"
    >
      <img src={`${base}/logo-dark.png`} alt="Spades Institute" class="h-20 md:h-24 w-auto object-contain" />
    </a>

    <!-- Desktop Nav -->
    <nav class="hidden md:flex items-center gap-1" aria-label="Main navigation">
      {navLinks.map((link) => (
        <a
          class:list={[
            'nav-link px-3 py-2 rounded-md text-sm font-medium transition-colors focus-white',
            isActive(link.href) 
              ? 'text-white bg-white/10' 
              : 'text-white/75 hover:text-white hover:bg-white/5'
          ]}
          href={link.href}
          aria-current={isActive(link.href) ? 'page' : undefined}
        >
          {link.label}
        </a>
      ))}
    </nav>

    <!-- CTAs -->
    <div class="flex items-center gap-2">
      <a
        class="hidden sm:inline-flex nav-link px-3 py-2 rounded-md text-sm font-medium text-white/75 hover:text-white hover:bg-white/5 transition-colors focus-white"
        href={`${base}/connect`}
        aria-label="Partner with Spades Institute"
      >
        Partner With Us
      </a>
      <a
        class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-semibold bg-white text-spades-ink-deep hover:bg-white/90 transition-colors focus-accent"
        href="https://givebutter.com/spades-institute"
        target="_blank"
        rel="noreferrer"
      >
        Donate
      </a>

      <!-- Mobile Menu Button -->
      <details class="md:hidden relative">
        <summary class="list-none cursor-pointer select-none p-2 rounded-md hover:bg-white/10 focus-white">
          <span class="sr-only">Open menu</span>
          <MenuIcon class="w-6 h-6 text-white" />
        </summary>
        <div class="absolute right-0 mt-2 w-56 rounded-xl border border-white/10 shadow-lg p-2 motion-safe:animate-slideDown" style="background-color: #0a0f1c;">
          {navLinks.map((link) => (
            <a
              class:list={[
                'block px-4 py-2.5 rounded-lg text-sm font-medium transition-colors',
                isActive(link.href) 
                  ? 'bg-white/10 text-white' 
                  : 'text-white/80 hover:bg-white/5 hover:text-white'
              ]}
              href={link.href}
              aria-current={isActive(link.href) ? 'page' : undefined}
            >
              {link.label}
            </a>
          ))}
          <hr class="my-2 border-white/10" />
          <a
            class="block px-4 py-2.5 rounded-lg text-sm font-medium text-white/80 hover:bg-white/5 hover:text-white transition-colors"
            href={`${base}/connect`}
            aria-label="Partner with Spades Institute"
          >
            Partner With Us
          </a>
        </div>
      </details>
    </div>
  </div>
</header>
