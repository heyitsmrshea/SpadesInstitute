---
const { person, variant = 'dark', index = 0 } = Astro.props;
const isDark = variant === 'dark';
const baseRaw = import.meta.env.BASE_URL || '/';
const base = baseRaw.endsWith('/') ? baseRaw : `${baseRaw}/`;
const hasFullBio = person.fullBio && person.fullBio.length > 0;
const cardId = `bio-card-${person.name.toLowerCase().replace(/\s+/g, '-')}`;
---
<article
  class:list={[
    'group flex flex-col gap-4 motion-safe:animate-fadeUp transition-all duration-300',
    isDark
      ? 'bg-transparent p-6'
      : 'bg-white border border-spades-border rounded-[1.25rem] p-6 shadow-card hover:shadow-xl',
    hasFullBio ? 'cursor-pointer' : ''
  ]}
  style={`animation-delay: ${index * 100}ms`}
  id={cardId}
  {...(hasFullBio && {
    'data-expandable': 'true',
    'aria-expanded': 'false',
    'role': 'button',
    'tabindex': '0'
  })}
>
  <div class:list={['flex items-center gap-4', isDark ? 'justify-center text-center flex-col' : '']}>
    <img
      src={`${base}${person.headshot.replace(/^\//, '')}`}
      alt={`${person.name} headshot`}
      loading="lazy"
      class:list={[
        'rounded-full object-cover transition-all duration-500 group-hover:scale-110 group-hover:shadow-2xl',
        isDark
          ? 'w-48 h-48 md:w-56 md:h-56 lg:w-64 lg:h-64 border-4 border-white/30 shadow-card'
          : 'w-24 h-24 md:w-28 md:h-28 border-2 border-spades-border grayscale hover:grayscale-0'
      ]}
    />
    <div class="flex-1">
      <div class="flex items-start justify-between gap-4">
        <div class="flex-1">
          <p class:list={['text-lg font-semibold', isDark ? 'text-white underline underline-offset-6 decoration-white/30' : 'text-spades-ink']}>
            {person.name}
          </p>
          <p class:list={['text-sm', isDark ? 'text-white/80' : 'text-spades-muted']}>{person.role}</p>
        </div>
        {hasFullBio && (
          <button
            class="expand-chevron inline-flex items-center justify-center w-8 h-8 rounded-full transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2"
            class:list={[
              isDark
                ? 'text-white/70 hover:text-white hover:bg-white/10 focus-visible:ring-white/50 focus-visible:ring-offset-spades-ink'
                : 'text-spades-muted hover:text-spades-ink hover:bg-spades-paper focus-visible:ring-spades-ink/30 focus-visible:ring-offset-white'
            ]}
            aria-label="Toggle biography"
            aria-expanded="false"
            aria-controls={`${cardId}-content`}
            type="button"
          >
            <svg
              class="w-5 h-5 transition-transform duration-300"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
        )}
      </div>
    </div>
  </div>

  <p class:list={['text-sm leading-relaxed', isDark ? 'text-white/80' : 'text-spades-muted']}>
    {person.bio}
  </p>

  {hasFullBio && (
    <div
      id={`${cardId}-content`}
      class="bio-content overflow-hidden transition-all duration-300 ease-out"
      style="max-height: 0; opacity: 0;"
      aria-hidden="true"
    >
      <div class="pt-4 mt-4 border-t" class:list={[isDark ? 'border-white/20' : 'border-spades-border']}>
        <div class="space-y-4">
          {person.fullBio.map((paragraph) => (
            <p class:list={['leading-relaxed', isDark ? 'text-white/90' : 'text-spades-muted']}>
              {paragraph}
            </p>
          ))}
        </div>
      </div>
    </div>
  )}

  {person.linkedin && (
    <div class:list={[isDark ? 'flex justify-center' : '']}>
      <a
        class:list={[
          'inline-flex items-center justify-center w-11 h-11 rounded-full border transition focus:outline-none focus-visible:ring-2',
          isDark ? 'border-white/25 text-white/90 hover:border-white focus-visible:ring-white/40' : 'border-spades-border text-spades-ink hover:border-spades-ink focus-visible:ring-spades-ink/30'
        ]}
        href={person.linkedin}
        target="_blank"
        rel="noreferrer"
        aria-label={`Open ${person.name} on LinkedIn`}
        onclick={(e) => e.stopPropagation()}
      >
        <svg viewBox="0 0 24 24" class:list={['w-4 h-4', isDark ? 'fill-white/90' : 'fill-spades-ink']} aria-hidden="true">
          <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.35V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.6 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.063 2.063 0 114.126 0 2.062 2.062 0 01-2.063 2.065zM6.114 20.452H4.56V9h3.554v11.452H6.114zM22.225 0H1.771C.792 0 0 .774 0 1.727v20.545C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.273V1.727C24 .774 23.2 0 22.222 0h.003z" />
        </svg>
      </a>
    </div>
  )}
</article>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const expandableCards = document.querySelectorAll('[data-expandable="true"]');
    
    expandableCards.forEach((card) => {
      const button = card.querySelector('.expand-chevron');
      const content = card.querySelector('.bio-content');
      const chevron = button?.querySelector('svg');
      
      if (!button || !content) return;
      
      const toggle = () => {
        const isExpanded = card.getAttribute('aria-expanded') === 'true';
        const newState = !isExpanded;
        
        card.setAttribute('aria-expanded', String(newState));
        button.setAttribute('aria-expanded', String(newState));
        content.setAttribute('aria-hidden', String(!newState));
        
        if (newState) {
          // Expand
          const scrollHeight = content.scrollHeight;
          content.style.maxHeight = `${scrollHeight}px`;
          content.style.opacity = '1';
          chevron?.style.setProperty('transform', 'rotate(180deg)');
          card.classList.add('shadow-xl');
        } else {
          // Collapse
          content.style.maxHeight = '0';
          content.style.opacity = '0';
          chevron?.style.setProperty('transform', 'rotate(0deg)');
          card.classList.remove('shadow-xl');
        }
      };
      
      // Click handlers
      card.addEventListener('click', (e) => {
        // Don't toggle if clicking the LinkedIn button
        if ((e.target as HTMLElement).closest('a[href*="linkedin"]')) return;
        toggle();
      });
      
      button.addEventListener('click', (e) => {
        e.stopPropagation();
        toggle();
      });
      
      // Keyboard handlers
      card.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggle();
        }
      });
      
      button.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggle();
        }
      });
    });
  });
</script>

<style>
  .bio-content {
    transition: max-height 300ms cubic-bezier(0.4, 0, 0.2, 1),
                opacity 300ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  [data-expandable="true"]:focus-visible {
    outline: 2px solid;
    outline-offset: 2px;
  }
  
  [data-expandable="true"][aria-expanded="true"] {
    transition: box-shadow 300ms ease-out;
  }
</style>

