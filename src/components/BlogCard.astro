---
import TagList from './TagList.astro';
import people from '../data/people.json';
const { post, featured = false } = Astro.props;
const baseRaw = import.meta.env.BASE_URL || '/';
const base = baseRaw.endsWith('/') ? baseRaw.slice(0, -1) : baseRaw;

// Find author in people.json for photo
const author = people.find(p => p.name === post.data.author);

// Calculate reading time (approx 200 words per minute)
const wordCount = post.body?.split(/\s+/).length || 0;
const readingTime = Math.ceil(wordCount / 200);

// Format date
const formattedDate = new Date(post.data.date).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric'
});
---
<a 
  href={`${base}/blog/${post.slug}`} 
  class:list={[
    "group block card card-hover overflow-hidden h-full bg-white",
    featured && "md:flex md:flex-row"
  ]}
>
  {post.data.featuredImage ? (
    <div class:list={[
      "overflow-hidden bg-spades-paper",
      featured ? "md:w-2/5 aspect-video" : "aspect-video"
    ]}>
      <img
        src={`${base}${post.data.featuredImage.replace(/^\//, '')}`}
        alt={post.data.title}
        width="400"
        height="225"
        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
        loading="lazy"
        decoding="async"
      />
    </div>
  ) : (
    <!-- Placeholder gradient when no image -->
    <div class:list={[
      "overflow-hidden bg-gradient-to-br from-spades-accent/10 to-spades-accent/5",
      featured ? "md:w-2/5 aspect-video" : "aspect-video"
    ]}>
      <div class="w-full h-full flex items-center justify-center">
        <div class="text-4xl text-spades-accent/30">♠︎</div>
      </div>
    </div>
  )}
  
  <div class:list={[
    "p-6 flex flex-col flex-1",
    featured && "md:p-6"
  ]}>
    <!-- Tags -->
    <div class="mb-3">
      <TagList tags={post.data.tags.slice(0, 3)} />
    </div>
    
    <!-- Title -->
    <h3 class:list={[
      "font-semibold text-spades-text mb-3 group-hover:text-spades-accent transition-colors leading-tight",
      featured ? "text-xl md:text-2xl" : "text-xl"
    ]}>
      {post.data.title}
    </h3>
    
    <!-- Excerpt -->
    <p class:list={[
      "text-spades-text-secondary leading-relaxed mb-4 flex-1",
      featured ? "text-sm clamp-3" : "text-sm clamp-3"
    ]}>
      {post.data.excerpt}
    </p>
    
    <!-- Meta -->
    <div class="flex flex-wrap items-center gap-x-4 gap-y-2 pt-4 border-t border-spades-border mt-auto">
      <div class="flex items-center gap-2">
        {author?.headshot && (
          <img
            src={`${base}${author.headshot.startsWith('/') ? author.headshot : '/' + author.headshot}`}
            alt={`${post.data.author} headshot`}
            class="w-6 h-6 rounded-full object-cover border border-spades-border"
            width="24"
            height="24"
            loading="lazy"
            decoding="async"
          />
        )}
        <span class="text-sm font-medium text-spades-text">{post.data.author}</span>
      </div>
      <div class="flex items-center gap-2 text-sm text-spades-text-secondary">
        <time datetime={post.data.date}>{formattedDate}</time>
        <span aria-hidden="true">·</span>
        <span>{readingTime} min read</span>
      </div>
    </div>
  </div>
</a>
