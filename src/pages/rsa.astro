---
import Layout from '../components/Layout.astro';
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const siteUrl = import.meta.env.PUBLIC_SITE_URL || 'https://www.spadesinstitute.org';

// Event Details - Update these for your specific events
const events = [
  {
    id: 'dinner',
    name: 'Mission Brief: Dinner',
    tagline: 'An evening of trusted conversation',
    date: 'Monday, April 28, 2025',
    time: '6:30 PM - 9:30 PM PT',
    location: 'San Francisco, CA',
    locationDetail: 'Venue details shared upon confirmation',
    description: 'Join fellow operators, innovators, and government leaders for an intimate dinner conversation on the intersection of cybersecurity and national security.',
    calendarStart: '20250428T183000',
    calendarEnd: '20250428T213000',
  },
  {
    id: 'breakfast',
    name: 'Mission Brief: Breakfast',
    tagline: 'Start the day with purpose',
    date: 'Tuesday, April 29, 2025',
    time: '7:30 AM - 9:00 AM PT',
    location: 'San Francisco, CA',
    locationDetail: 'Venue details shared upon confirmation',
    description: 'A working breakfast bringing together senior leaders to discuss emerging threats, opportunities, and collaborative solutions.',
    calendarStart: '20250429T073000',
    calendarEnd: '20250429T090000',
  }
];

// Generate Google Calendar URLs
function getGoogleCalendarUrl(event: typeof events[0]) {
  const title = encodeURIComponent(`Spades Institute: ${event.name}`);
  const details = encodeURIComponent(`${event.description}\n\nHosted by Spades Institute at RSA Conference 2025`);
  const location = encodeURIComponent(`${event.location}`);
  return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${event.calendarStart}/${event.calendarEnd}&details=${details}&location=${location}&ctz=America/Los_Angeles`;
}

// Generate ICS content
function getICSContent(event: typeof events[0]) {
  return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Spades Institute//RSA Events//EN
BEGIN:VEVENT
DTSTART;TZID=America/Los_Angeles:${event.calendarStart}
DTEND;TZID=America/Los_Angeles:${event.calendarEnd}
SUMMARY:Spades Institute: ${event.name}
DESCRIPTION:${event.description}\\n\\nHosted by Spades Institute at RSA Conference 2025
LOCATION:${event.location}
END:VEVENT
END:VCALENDAR`;
}
---

<Layout
  title="RSA Conference 2025 | Spades Institute"
  description="Join Spades Institute at RSA Conference 2025 for exclusive dinner and breakfast events bringing together government, industry, and academia leaders."
>
  <head slot="head">
    <link rel="canonical" href={`${siteUrl}${base}/rsa`} />
  </head>

  <style>
    /* Fighter Jet Ready Room Theme */
    .ready-room {
      background: linear-gradient(180deg, #0a0f0a 0%, #0d1117 50%, #0a0f0a 100%);
      position: relative;
    }

    .ready-room::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(34, 197, 94, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(34, 197, 94, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
    }

    .hud-border {
      border: 1px solid rgba(34, 197, 94, 0.3);
      position: relative;
    }

    .hud-border::before,
    .hud-border::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(34, 197, 94, 0.6);
    }

    .hud-border::before {
      top: -2px;
      left: -2px;
      border-right: none;
      border-bottom: none;
    }

    .hud-border::after {
      bottom: -2px;
      right: -2px;
      border-left: none;
      border-top: none;
    }

    .scanline {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.4), transparent);
      animation: scan 4s linear infinite;
      pointer-events: none;
    }

    @keyframes scan {
      0% { top: 0; opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { top: 100%; opacity: 0; }
    }

    .radar-pulse {
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      border: 1px solid rgba(34, 197, 94, 0.2);
      animation: pulse 3s ease-out infinite;
    }

    @keyframes pulse {
      0% { transform: scale(0.5); opacity: 0.8; }
      100% { transform: scale(2); opacity: 0; }
    }

    .glow-green {
      text-shadow: 0 0 10px rgba(34, 197, 94, 0.5), 0 0 20px rgba(34, 197, 94, 0.3);
    }

    .glow-amber {
      text-shadow: 0 0 10px rgba(251, 191, 36, 0.5), 0 0 20px rgba(251, 191, 36, 0.3);
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-indicator::before {
      content: '';
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
      animation: blink 2s ease-in-out infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .mission-card {
      background: rgba(10, 15, 10, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(34, 197, 94, 0.2);
      transition: all 0.3s ease;
    }

    .mission-card:hover {
      border-color: rgba(34, 197, 94, 0.5);
      box-shadow: 0 0 30px rgba(34, 197, 94, 0.1), inset 0 0 30px rgba(34, 197, 94, 0.02);
    }

    .btn-tactical {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(34, 197, 94, 0.1) 100%);
      border: 1px solid rgba(34, 197, 94, 0.4);
      color: #22c55e;
      transition: all 0.3s ease;
    }

    .btn-tactical:hover {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.3) 0%, rgba(34, 197, 94, 0.2) 100%);
      border-color: #22c55e;
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
    }

    .btn-tactical-primary {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      border: 1px solid #22c55e;
      color: #0a0f0a;
      font-weight: 600;
    }

    .btn-tactical-primary:hover {
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      box-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
    }

    .input-tactical {
      background: rgba(10, 15, 10, 0.6);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #e5e7eb;
      transition: all 0.3s ease;
    }

    .input-tactical:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1), 0 0 20px rgba(34, 197, 94, 0.1);
    }

    .input-tactical::placeholder {
      color: rgba(156, 163, 175, 0.6);
    }

    .checkbox-tactical {
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(34, 197, 94, 0.4);
      border-radius: 4px;
      background: rgba(10, 15, 10, 0.6);
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .checkbox-tactical:checked {
      background: #22c55e;
      border-color: #22c55e;
    }

    .checkbox-tactical:checked::after {
      content: '';
      position: absolute;
      left: 6px;
      top: 2px;
      width: 5px;
      height: 10px;
      border: solid #0a0f0a;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    .checkbox-tactical:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
    }
  </style>

  <!-- Hero Section -->
  <section class="ready-room min-h-[60vh] flex items-center justify-center relative overflow-hidden">
    <div class="scanline"></div>
    <div class="radar-pulse" style="top: 20%; left: 10%;"></div>
    <div class="radar-pulse" style="top: 60%; right: 5%; animation-delay: 1.5s;"></div>

    <div class="max-w-4xl mx-auto px-6 py-20 text-center relative z-10">
      <div class="mb-6">
        <span class="status-indicator text-xs uppercase tracking-[0.3em] text-green-400 font-mono">
          RSA Conference 2025 | San Francisco
        </span>
      </div>

      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6 glow-green font-sans" style="font-style: normal;">
        Mission Brief
      </h1>

      <p class="text-xl md:text-2xl text-green-400/80 mb-4 font-mono">
        SPADES INSTITUTE // EXCLUSIVE EVENTS
      </p>

      <p class="text-lg text-gray-400 max-w-2xl mx-auto leading-relaxed">
        Two invitation-only gatherings for leaders at the intersection of national security, technology, and innovation. Select your mission below.
      </p>

      <div class="mt-10 flex justify-center gap-3 flex-wrap">
        <a href="#events" class="btn-tactical px-6 py-3 rounded-lg font-mono text-sm uppercase tracking-wider inline-flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
          View Events
        </a>
        <a href="#signup" class="btn-tactical-primary px-6 py-3 rounded-lg font-mono text-sm uppercase tracking-wider inline-flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          Request Access
        </a>
      </div>
    </div>
  </section>

  <!-- Events Section -->
  <section id="events" class="ready-room py-20 relative">
    <div class="scanline" style="animation-delay: 2s;"></div>

    <div class="max-w-6xl mx-auto px-6">
      <div class="text-center mb-12">
        <p class="text-xs uppercase tracking-[0.3em] text-green-400/60 font-mono mb-3">Operations Schedule</p>
        <h2 class="text-3xl md:text-4xl font-bold text-white glow-green font-sans" style="font-style: normal;">
          Select Your Mission
        </h2>
      </div>

      <div class="grid md:grid-cols-2 gap-8">
        {events.map((event, index) => (
          <div class="mission-card rounded-xl p-8 hud-border">
            <div class="flex items-start justify-between mb-6">
              <div>
                <span class="text-xs uppercase tracking-wider text-amber-400 font-mono glow-amber">
                  Mission {String(index + 1).padStart(2, '0')}
                </span>
                <h3 class="text-2xl font-bold text-white mt-2 font-sans" style="font-style: normal;">
                  {event.name}
                </h3>
                <p class="text-green-400/70 text-sm mt-1">{event.tagline}</p>
              </div>
              <div class="w-12 h-12 rounded-full border border-green-500/30 flex items-center justify-center">
                {index === 0 ? (
                  <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                  </svg>
                ) : (
                  <svg class="w-6 h-6 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                  </svg>
                )}
              </div>
            </div>

            <div class="space-y-4 mb-6">
              <div class="flex items-center gap-3 text-gray-300">
                <svg class="w-5 h-5 text-green-400/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span class="font-mono text-sm">{event.date}</span>
              </div>
              <div class="flex items-center gap-3 text-gray-300">
                <svg class="w-5 h-5 text-green-400/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span class="font-mono text-sm">{event.time}</span>
              </div>
              <div class="flex items-center gap-3 text-gray-300">
                <svg class="w-5 h-5 text-green-400/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span class="font-mono text-sm">{event.location}</span>
              </div>
            </div>

            <p class="text-gray-400 text-sm leading-relaxed mb-6">
              {event.description}
            </p>

            <div class="flex flex-wrap gap-3">
              <a
                href={getGoogleCalendarUrl(event)}
                target="_blank"
                rel="noreferrer"
                class="btn-tactical px-4 py-2 rounded-lg font-mono text-xs uppercase tracking-wider inline-flex items-center gap-2"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                Google Calendar
              </a>
              <button
                class="btn-tactical px-4 py-2 rounded-lg font-mono text-xs uppercase tracking-wider inline-flex items-center gap-2 download-ics"
                data-event-id={event.id}
                data-ics-content={getICSContent(event)}
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                Download .ics
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Signup Form Section -->
  <section id="signup" class="ready-room py-20 relative">
    <div class="scanline" style="animation-delay: 1s;"></div>

    <div class="max-w-2xl mx-auto px-6">
      <div class="mission-card rounded-xl p-8 md:p-10 hud-border">
        <div class="text-center mb-8">
          <p class="text-xs uppercase tracking-[0.3em] text-amber-400 font-mono mb-3 glow-amber">Access Request</p>
          <h2 class="text-2xl md:text-3xl font-bold text-white glow-green font-sans" style="font-style: normal;">
            Request Your Briefing
          </h2>
          <p class="text-gray-400 mt-3 text-sm">
            Submit your credentials below. Venue details and confirmation will be sent to approved attendees.
          </p>
        </div>

        <!-- Success Message -->
        <div id="form-success" class="hidden mb-6 p-4 rounded-lg bg-green-500/10 border border-green-500/30">
          <p class="text-green-400 font-semibold font-mono text-sm">ACCESS REQUEST TRANSMITTED</p>
          <p class="text-green-400/70 text-sm mt-1">Stand by for confirmation. Check your inbox for next steps.</p>
        </div>

        <!-- Error Message -->
        <div id="form-error" class="hidden mb-6 p-4 rounded-lg bg-red-500/10 border border-red-500/30">
          <p class="text-red-400 font-semibold font-mono text-sm" id="error-message">TRANSMISSION FAILED</p>
        </div>

        <form id="rsaSignupForm" class="space-y-5">
          <div>
            <label for="signup-name" class="block text-sm font-medium text-gray-300 mb-2 font-mono uppercase tracking-wider">
              Name <span class="text-red-400">*</span>
            </label>
            <input
              id="signup-name"
              name="name"
              type="text"
              required
              placeholder="Your full name"
              class="input-tactical w-full rounded-lg px-4 py-3"
            />
          </div>

          <div>
            <label for="signup-company" class="block text-sm font-medium text-gray-300 mb-2 font-mono uppercase tracking-wider">
              Organization <span class="text-red-400">*</span>
            </label>
            <input
              id="signup-company"
              name="company"
              type="text"
              required
              placeholder="Your company or agency"
              class="input-tactical w-full rounded-lg px-4 py-3"
            />
          </div>

          <div>
            <label for="signup-email" class="block text-sm font-medium text-gray-300 mb-2 font-mono uppercase tracking-wider">
              Email <span class="text-red-400">*</span>
            </label>
            <input
              id="signup-email"
              name="email"
              type="email"
              required
              placeholder="your.email@organization.com"
              class="input-tactical w-full rounded-lg px-4 py-3"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-3 font-mono uppercase tracking-wider">
              Select Mission(s) <span class="text-red-400">*</span>
            </label>
            <div class="space-y-3">
              {events.map((event) => (
                <label class="flex items-start gap-3 cursor-pointer group">
                  <input
                    type="checkbox"
                    name="events"
                    value={event.id}
                    class="checkbox-tactical mt-0.5"
                  />
                  <div>
                    <span class="text-gray-200 font-medium group-hover:text-green-400 transition-colors">
                      {event.name}
                    </span>
                    <span class="block text-xs text-gray-500 font-mono">{event.date} | {event.time}</span>
                  </div>
                </label>
              ))}
            </div>
          </div>

          <div class="pt-4">
            <button
              type="submit"
              id="submit-btn"
              class="btn-tactical-primary w-full px-6 py-4 rounded-lg font-mono text-sm uppercase tracking-wider inline-flex items-center justify-center gap-2"
            >
              <span id="submit-text">Submit Access Request</span>
              <span id="submit-spinner" class="hidden">
                <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </span>
              <svg id="submit-arrow" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </button>
          </div>

          <p class="text-xs text-gray-500 text-center font-mono">
            Your information is secure. We'll only use it to coordinate event logistics.
          </p>
        </form>
      </div>
    </div>
  </section>

  <!-- Footer Info -->
  <section class="ready-room py-12 border-t border-green-500/10">
    <div class="max-w-4xl mx-auto px-6 text-center">
      <p class="text-gray-500 text-sm font-mono mb-4">
        Questions? Contact <a href="mailto:info@spadesinstitute.org" class="text-green-400 hover:text-green-300 transition-colors">info@spadesinstitute.org</a>
      </p>
      <div class="flex items-center justify-center gap-6 text-xs text-gray-600 font-mono uppercase tracking-wider">
        <a href={`${base}/`} class="hover:text-green-400 transition-colors">Home</a>
        <span class="text-green-500/30">|</span>
        <a href={`${base}/about/`} class="hover:text-green-400 transition-colors">About</a>
        <span class="text-green-500/30">|</span>
        <a href={`${base}/connect/`} class="hover:text-green-400 transition-colors">Connect</a>
      </div>
    </div>
  </section>

  <script>
    // ICS Download functionality
    document.querySelectorAll('.download-ics').forEach(button => {
      button.addEventListener('click', () => {
        const icsContent = button.getAttribute('data-ics-content');
        const eventId = button.getAttribute('data-event-id');

        if (icsContent) {
          const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `spades-rsa-${eventId}.ics`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }
      });
    });

    // Form submission
    const form = document.getElementById('rsaSignupForm');
    const submitBtn = document.getElementById('submit-btn');
    const submitText = document.getElementById('submit-text');
    const submitSpinner = document.getElementById('submit-spinner');
    const submitArrow = document.getElementById('submit-arrow');
    const formSuccess = document.getElementById('form-success');
    const formError = document.getElementById('form-error');
    const errorMessage = document.getElementById('error-message');

    if (form) {
      form.addEventListener('submit', async (event) => {
        event.preventDefault();

        // Hide previous messages
        if (formSuccess) formSuccess.classList.add('hidden');
        if (formError) formError.classList.add('hidden');

        // Get form data
        const data = new FormData(form);
        const selectedEvents = data.getAll('events');

        const payload = {
          name: String(data.get('name') || ''),
          company: String(data.get('company') || ''),
          email: String(data.get('email') || ''),
          events: selectedEvents,
        };

        // Validate required fields
        if (!payload.name || !payload.company || !payload.email) {
          if (formError && errorMessage) {
            errorMessage.textContent = 'Please fill in all required fields.';
            formError.classList.remove('hidden');
          }
          return;
        }

        // Validate at least one event selected
        if (selectedEvents.length === 0) {
          if (formError && errorMessage) {
            errorMessage.textContent = 'Please select at least one event.';
            formError.classList.remove('hidden');
          }
          return;
        }

        // Validate email format
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(payload.email)) {
          if (formError && errorMessage) {
            errorMessage.textContent = 'Please enter a valid email address.';
            formError.classList.remove('hidden');
          }
          return;
        }

        // Show loading state
        if (submitBtn) submitBtn.disabled = true;
        if (submitText) submitText.textContent = 'Transmitting...';
        if (submitSpinner) submitSpinner.classList.remove('hidden');
        if (submitArrow) submitArrow.classList.add('hidden');

        try {
          // Format event names for the message
          const eventNames = selectedEvents.map(id => {
            if (id === 'dinner') return 'Mission Brief: Dinner (April 28)';
            if (id === 'breakfast') return 'Mission Brief: Breakfast (April 29)';
            return id;
          }).join(', ');

          const formattedMessage = `
RSA Conference 2025 Event Signup

Name: ${payload.name}
Organization: ${payload.company}
Email: ${payload.email}
Selected Events: ${eventNames}

Submitted via RSA signup page
          `.trim();

          const response = await fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              access_key: '217a97ca-0557-4364-86f7-66e28fbd499f',
              subject: `RSA 2025 Event Signup - ${payload.name} (${payload.company})`,
              from_name: payload.name,
              email: payload.email,
              replyto: payload.email,
              message: formattedMessage,
            }),
          });

          const result = await response.json();

          if (response.ok && result.success) {
            // Show success
            if (formSuccess) formSuccess.classList.remove('hidden');
            form.reset();
            formSuccess?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          } else {
            if (formError && errorMessage) {
              errorMessage.textContent = result.message || 'Transmission failed. Please try again.';
              formError.classList.remove('hidden');
            }
          }
        } catch (error) {
          if (formError && errorMessage) {
            errorMessage.textContent = 'Network error. Please check your connection and try again.';
            formError.classList.remove('hidden');
          }
        } finally {
          // Reset button
          if (submitBtn) submitBtn.disabled = false;
          if (submitText) submitText.textContent = 'Submit Access Request';
          if (submitSpinner) submitSpinner.classList.add('hidden');
          if (submitArrow) submitArrow.classList.remove('hidden');
        }
      });
    }
  </script>
</Layout>
