---
import Layout from '../components/Layout.astro';
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const siteUrl = import.meta.env.PUBLIC_SITE_URL || 'https://www.spadesinstitute.org';

const events = [
  {
    id: 'dinner',
    name: 'Mission Brief: Dinner',
    tagline: 'An evening of trusted conversation',
    date: 'Monday, April 28, 2025',
    time: '6:30 PM - 9:30 PM PT',
    location: 'San Francisco, CA',
    locationDetail: 'Venue details shared upon confirmation',
    description: 'Join fellow operators, innovators, and government leaders for an intimate dinner conversation on the intersection of cybersecurity and national security.',
    calendarStart: '20250428T183000',
    calendarEnd: '20250428T213000',
  },
  {
    id: 'breakfast',
    name: 'Mission Brief: Breakfast',
    tagline: 'Start the day with purpose',
    date: 'Tuesday, April 29, 2025',
    time: '7:30 AM - 9:00 AM PT',
    location: 'San Francisco, CA',
    locationDetail: 'Venue details shared upon confirmation',
    description: 'A working breakfast bringing together senior leaders to discuss emerging threats, opportunities, and collaborative solutions.',
    calendarStart: '20250429T073000',
    calendarEnd: '20250429T090000',
  }
];

function getGoogleCalendarUrl(event: typeof events[0]) {
  const title = encodeURIComponent(`Spades Institute: ${event.name}`);
  const details = encodeURIComponent(`${event.description}\n\nHosted by Spades Institute at RSA Conference 2025`);
  const location = encodeURIComponent(`${event.location}`);
  return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${event.calendarStart}/${event.calendarEnd}&details=${details}&location=${location}&ctz=America/Los_Angeles`;
}

function getICSContent(event: typeof events[0]) {
  return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Spades Institute//RSA Events//EN
BEGIN:VEVENT
DTSTART;TZID=America/Los_Angeles:${event.calendarStart}
DTEND;TZID=America/Los_Angeles:${event.calendarEnd}
SUMMARY:Spades Institute: ${event.name}
DESCRIPTION:${event.description}\\n\\nHosted by Spades Institute at RSA Conference 2025
LOCATION:${event.location}
END:VEVENT
END:VCALENDAR`;
}
---

<Layout
  title="RSA Conference 2025 | Spades Institute - Design 5"
  description="Join Spades Institute at RSA Conference 2025 for exclusive dinner and breakfast events."
>
  <head slot="head">
    <link rel="canonical" href={`${siteUrl}${base}/rsa5`} />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  </head>

  <style>
    /* ===== V5: STEALTH ELITE - ULTRA-MINIMAL PREMIUM ===== */
    
    .font-clean {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    /* Pure dark background */
    .stealth-bg {
      background: #000000;
      position: relative;
    }

    /* Subtle gradient overlay */
    .stealth-bg::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at 50% 0%, rgba(255,255,255,0.03) 0%, transparent 50%);
      pointer-events: none;
    }

    /* Minimal grid pattern */
    .stealth-grid::after {
      content: '';
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 80px 80px;
      pointer-events: none;
      opacity: 0.5;
    }

    /* Particle Animation */
    .particles {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      animation: particleFloat 15s linear infinite;
    }

    .particle:nth-child(1) { left: 10%; animation-delay: 0s; }
    .particle:nth-child(2) { left: 20%; animation-delay: 2s; }
    .particle:nth-child(3) { left: 30%; animation-delay: 4s; }
    .particle:nth-child(4) { left: 50%; animation-delay: 1s; }
    .particle:nth-child(5) { left: 70%; animation-delay: 3s; }
    .particle:nth-child(6) { left: 80%; animation-delay: 5s; }
    .particle:nth-child(7) { left: 90%; animation-delay: 2.5s; }

    @keyframes particleFloat {
      0% { transform: translateY(100vh) scale(0); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-100vh) scale(1); opacity: 0; }
    }

    /* Geometric Accents */
    .geometric-accent {
      position: absolute;
      width: 200px;
      height: 200px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      transform: rotate(45deg);
      pointer-events: none;
    }

    .geometric-accent.top-left {
      top: -100px;
      left: -100px;
    }

    .geometric-accent.bottom-right {
      bottom: -100px;
      right: -100px;
    }

    /* Monogram Logo */
    .monogram-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 2rem;
    }

    .monogram-icon {
      width: 60px;
      height: 60px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: rgba(255, 255, 255, 0.8);
      background: rgba(255, 255, 255, 0.02);
    }

    /* Enhanced Micro-interactions */
    .glass-card {
      position: relative;
    }

    .glass-card::after {
      content: '';
      position: absolute;
      inset: 0;
      border: 1px solid transparent;
      border-radius: inherit;
      transition: border-color 0.4s ease;
    }

    .glass-card:hover::after {
      border-color: rgba(255, 255, 255, 0.1);
    }

    /* Button micro-interactions */
    .btn-stealth {
      position: relative;
      overflow: hidden;
    }

    .btn-stealth::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: translateX(-100%);
      transition: transform 0.5s ease;
    }

    .btn-stealth:hover::before {
      transform: translateX(100%);
    }

    /* Gradient text on title */
    .gradient-title {
      background: linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.6) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Testimonial/Stats */
    .trust-stat {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin: 1.5rem 0;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.4);
    }

    .trust-stat strong {
      color: rgba(255, 255, 255, 0.7);
    }

    /* Success animation */
    .success-pulse {
      animation: successPulse 0.5s ease-out;
    }

    @keyframes successPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    /* Focus animations */
    .input-stealth:focus {
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.05);
    }

    .input-stealth:focus + label,
    .input-stealth:not(:placeholder-shown) + label {
      transform: translateY(-20px) scale(0.85);
      color: rgba(255, 255, 255, 0.5);
    }

    /* Accent line */
    .accent-line {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    }

    /* Premium title styling */
    .stealth-title {
      font-weight: 300;
      letter-spacing: 0.2em;
      color: white;
    }

    .stealth-title-bold {
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    /* Subtle glow effect */
    .subtle-glow {
      text-shadow: 0 0 40px rgba(255,255,255,0.1);
    }

    /* Glass card */
    .glass-card {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(20px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .glass-card:hover {
      background: rgba(255,255,255,0.04);
      border-color: rgba(255,255,255,0.12);
      transform: translateY(-4px);
    }

    /* Minimal badge */
    .minimal-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem 0.875rem;
      border: 1px solid rgba(255,255,255,0.15);
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.6);
    }

    /* Clean buttons */
    .btn-stealth {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .btn-stealth:hover {
      background: rgba(255,255,255,0.05);
      border-color: rgba(255,255,255,0.4);
      color: white;
    }

    .btn-stealth-primary {
      background: white;
      border-color: white;
      color: black;
    }

    .btn-stealth-primary:hover {
      background: rgba(255,255,255,0.9);
      box-shadow: 0 0 40px rgba(255,255,255,0.2);
    }

    /* Input styling */
    .input-stealth {
      width: 100%;
      padding: 1rem 1.25rem;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.1);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 400;
      color: white;
      transition: all 0.3s ease;
    }

    .input-stealth:focus {
      outline: none;
      background: rgba(255,255,255,0.05);
      border-color: rgba(255,255,255,0.3);
    }

    .input-stealth::placeholder {
      color: rgba(255,255,255,0.3);
    }

    /* Checkbox */
    .checkbox-stealth {
      appearance: none;
      width: 18px;
      height: 18px;
      border: 1px solid rgba(255,255,255,0.2);
      background: transparent;
      cursor: pointer;
      flex-shrink: 0;
      transition: all 0.2s ease;
    }

    .checkbox-stealth:checked {
      background: white;
      border-color: white;
    }

    .checkbox-stealth:checked::after {
      content: '✓';
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: black;
      height: 100%;
    }

    /* Data row */
    .data-row-minimal {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .data-row-minimal:last-child {
      border-bottom: none;
    }

    .data-icon-minimal {
      width: 16px;
      height: 16px;
      color: rgba(255,255,255,0.3);
    }

    .data-text {
      font-size: 14px;
      color: rgba(255,255,255,0.7);
      font-weight: 400;
    }

    /* Status dot */
    .status-dot {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-dot::before {
      content: '';
      width: 6px;
      height: 6px;
      background: #22c55e;
      border-radius: 50%;
      animation: dotPulse 3s ease-in-out infinite;
    }

    @keyframes dotPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* Section label */
    .section-label {
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.3);
    }

    /* Form label */
    .form-label-minimal {
      display: block;
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.4);
      margin-bottom: 0.625rem;
    }

    /* Reveal animations */
    .reveal-fade {
      opacity: 0;
      transform: translateY(20px);
      animation: revealFade 1s ease-out forwards;
    }

    .reveal-delay-1 { animation-delay: 0.2s; }
    .reveal-delay-2 { animation-delay: 0.4s; }
    .reveal-delay-3 { animation-delay: 0.6s; }
    .reveal-delay-4 { animation-delay: 0.8s; }

    @keyframes revealFade {
      to { opacity: 1; transform: translateY(0); }
    }

    /* Divider */
    .minimal-divider {
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .minimal-divider::after {
      content: '';
      width: 1px;
      height: 40px;
      background: linear-gradient(180deg, transparent, rgba(255,255,255,0.2), transparent);
    }

    /* Footer links */
    .footer-link {
      font-size: 12px;
      font-weight: 400;
      color: rgba(255,255,255,0.4);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-link:hover {
      color: white;
    }

    /* Form panel */
    .form-panel-stealth {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.06);
    }

    /* Success/Error */
    .alert-success-stealth {
      background: rgba(34,197,94,0.1);
      border: 1px solid rgba(34,197,94,0.2);
      padding: 1rem;
    }

    .alert-error-stealth {
      background: rgba(239,68,68,0.1);
      border: 1px solid rgba(239,68,68,0.2);
      padding: 1rem;
    }

    /* Counter badge */
    .counter-badge {
      font-size: 48px;
      font-weight: 200;
      color: rgba(255,255,255,0.1);
      line-height: 1;
    }
  </style>

  <!-- Hero Section -->
  <section class="stealth-bg stealth-grid min-h-[85vh] flex items-center justify-center relative overflow-hidden">
    <!-- Particles -->
    <div class="particles">
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
    </div>

    <!-- Geometric Accents -->
    <div class="geometric-accent top-left"></div>
    <div class="geometric-accent bottom-right"></div>

    <div class="max-w-4xl mx-auto px-6 py-28 text-center relative z-10">
      <!-- Monogram Logo -->
      <div class="monogram-logo reveal-fade">
        <div class="monogram-icon">♠</div>
      </div>

      <div class="mb-8 reveal-fade">
        <span class="status-dot font-clean text-xs uppercase tracking-[0.25em] text-white/50">
          RSA Conference 2025
        </span>
      </div>

      <h1 class="font-clean stealth-title gradient-title text-4xl md:text-5xl lg:text-6xl mb-4 subtle-glow reveal-fade reveal-delay-1">
        MISSION BRIEF
      </h1>

      <div class="accent-line max-w-xs mx-auto mb-8 reveal-fade reveal-delay-1"></div>

      <p class="font-clean text-lg md:text-xl text-white/40 font-light tracking-wide mb-3 reveal-fade reveal-delay-2">
        Spades Institute
      </p>

      <p class="font-clean text-base text-white/30 max-w-lg mx-auto leading-relaxed font-light reveal-fade reveal-delay-2">
        Two invitation-only gatherings for leaders at the intersection of national security, technology, and innovation.
      </p>

      <!-- Trust Stat -->
      <div class="trust-stat reveal-fade reveal-delay-2">
        Trusted by <strong>75+ leaders</strong> from government & Fortune 500
      </div>

      <div class="mt-10 flex justify-center gap-4 flex-wrap reveal-fade reveal-delay-3">
        <a href="#events" class="btn-stealth">
          View Events
        </a>
        <a href="#signup" class="btn-stealth-primary">
          Request Access
        </a>
      </div>
    </div>
  </section>

  <!-- Divider -->
  <div class="stealth-bg">
    <div class="minimal-divider"></div>
  </div>

  <!-- Events Section -->
  <section id="events" class="stealth-bg py-24 relative">
    <div class="max-w-5xl mx-auto px-6">
      <div class="text-center mb-20">
        <p class="section-label mb-4">Schedule</p>
        <h2 class="font-clean stealth-title-bold text-3xl md:text-4xl text-white">
          Select Your Event
        </h2>
      </div>

      <div class="grid md:grid-cols-2 gap-8">
        {events.map((event, index) => (
          <div class="glass-card p-8 relative">
            <div class="flex items-start justify-between mb-8">
              <div>
                <span class="minimal-badge mb-4">
                  Event {String(index + 1).padStart(2, '0')}
                </span>
                <h3 class="font-clean stealth-title-bold text-xl text-white mt-4">
                  {event.name}
                </h3>
                <p class="font-clean text-sm text-white/40 mt-1 font-light">{event.tagline}</p>
              </div>
              <span class="counter-badge">{String(index + 1).padStart(2, '0')}</span>
            </div>

            <div class="mb-8">
              <div class="data-row-minimal">
                <svg class="data-icon-minimal" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span class="data-text">{event.date}</span>
              </div>
              <div class="data-row-minimal">
                <svg class="data-icon-minimal" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span class="data-text">{event.time}</span>
              </div>
              <div class="data-row-minimal">
                <svg class="data-icon-minimal" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span class="data-text">{event.location}</span>
              </div>
            </div>

            <p class="font-clean text-sm text-white/40 leading-relaxed font-light mb-8">
              {event.description}
            </p>

            <div class="flex flex-wrap gap-3">
              <a href={getGoogleCalendarUrl(event)} target="_blank" rel="noreferrer" class="btn-stealth text-xs">
                Add to Calendar
              </a>
              <button class="btn-stealth text-xs download-ics" data-event-id={event.id} data-ics-content={getICSContent(event)}>
                Download .ICS
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Divider -->
  <div class="stealth-bg">
    <div class="minimal-divider"></div>
  </div>

  <!-- Signup Form Section -->
  <section id="signup" class="stealth-bg py-24 relative">
    <div class="max-w-lg mx-auto px-6">
      <div class="text-center mb-12">
        <p class="section-label mb-4">Access</p>
        <h2 class="font-clean stealth-title-bold text-2xl md:text-3xl text-white">
          Request Your Briefing
        </h2>
        <p class="font-clean text-sm text-white/30 mt-4 font-light">
          Submit your details below. Venue information provided upon approval.
        </p>
      </div>

      <div class="form-panel-stealth p-8 md:p-10">
        <div id="form-success" class="hidden mb-6 alert-success-stealth">
          <p class="font-clean text-green-400 text-sm font-medium">Request Submitted</p>
          <p class="font-clean text-green-400/70 text-xs mt-1">Check your inbox for confirmation.</p>
        </div>

        <div id="form-error" class="hidden mb-6 alert-error-stealth">
          <p class="font-clean text-red-400 text-sm" id="error-message">Submission failed</p>
        </div>

        <form id="rsaSignupForm" class="space-y-6">
          <div>
            <label for="signup-name" class="form-label-minimal">Name <span class="text-red-400">*</span></label>
            <input id="signup-name" name="name" type="text" required placeholder="Your full name" class="input-stealth" />
          </div>

          <div>
            <label for="signup-company" class="form-label-minimal">Organization <span class="text-red-400">*</span></label>
            <input id="signup-company" name="company" type="text" required placeholder="Company or agency" class="input-stealth" />
          </div>

          <div>
            <label for="signup-email" class="form-label-minimal">Email <span class="text-red-400">*</span></label>
            <input id="signup-email" name="email" type="email" required placeholder="your.email@organization.com" class="input-stealth" />
          </div>

          <div>
            <label class="form-label-minimal">Select Event(s) <span class="text-red-400">*</span></label>
            <div class="space-y-3 mt-4">
              {events.map((event) => (
                <label class="flex items-start gap-3 cursor-pointer group p-3 border border-transparent hover:border-white/10 hover:bg-white/02 transition-all">
                  <input type="checkbox" name="events" value={event.id} class="checkbox-stealth mt-0.5" />
                  <div>
                    <span class="font-clean text-sm text-white/80 font-medium group-hover:text-white transition-colors">{event.name}</span>
                    <span class="block text-xs text-white/30 mt-0.5">{event.date}</span>
                  </div>
                </label>
              ))}
            </div>
          </div>

          <div class="pt-4">
            <button type="submit" id="submit-btn" class="btn-stealth-primary w-full justify-center py-4 text-sm">
              <span id="submit-text">Submit Request</span>
              <span id="submit-spinner" class="hidden">Processing...</span>
              <span id="submit-arrow">→</span>
            </button>
          </div>

          <p class="font-clean text-xs text-white/20 text-center font-light">
            Your information is secure and used only for event coordination.
          </p>
        </form>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <section class="stealth-bg py-16 border-t border-white/05">
    <div class="max-w-4xl mx-auto px-6 text-center">
      <p class="font-clean text-sm text-white/30 mb-8 font-light">
        Questions? <a href="mailto:info@spadesinstitute.org" class="text-white/50 hover:text-white transition-colors">info@spadesinstitute.org</a>
      </p>

      <div class="flex items-center justify-center gap-8">
        <a href={`${base}/`} class="footer-link">Home</a>
        <a href={`${base}/about/`} class="footer-link">About</a>
        <a href={`${base}/connect/`} class="footer-link">Connect</a>
      </div>

      <p class="font-clean text-[10px] text-white/15 mt-10 tracking-widest uppercase">
        Spades Institute © 2025
      </p>
    </div>
  </section>

  <script>
    document.querySelectorAll('.download-ics').forEach(button => {
      button.addEventListener('click', () => {
        const icsContent = button.getAttribute('data-ics-content');
        const eventId = button.getAttribute('data-event-id');
        if (icsContent) {
          const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `spades-rsa-${eventId}.ics`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }
      });
    });

    const form = document.getElementById('rsaSignupForm');
    const submitBtn = document.getElementById('submit-btn');
    const submitText = document.getElementById('submit-text');
    const submitSpinner = document.getElementById('submit-spinner');
    const submitArrow = document.getElementById('submit-arrow');
    const formSuccess = document.getElementById('form-success');
    const formError = document.getElementById('form-error');
    const errorMessage = document.getElementById('error-message');

    if (form) {
      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        if (formSuccess) formSuccess.classList.add('hidden');
        if (formError) formError.classList.add('hidden');

        const data = new FormData(form);
        const selectedEvents = data.getAll('events');
        const payload = {
          name: String(data.get('name') || ''),
          company: String(data.get('company') || ''),
          email: String(data.get('email') || ''),
          events: selectedEvents,
        };

        if (!payload.name || !payload.company || !payload.email) {
          if (formError && errorMessage) {
            errorMessage.textContent = 'Please fill in all required fields.';
            formError.classList.remove('hidden');
          }
          return;
        }

        if (selectedEvents.length === 0) {
          if (formError && errorMessage) {
            errorMessage.textContent = 'Please select at least one event.';
            formError.classList.remove('hidden');
          }
          return;
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(payload.email)) {
          if (formError && errorMessage) {
            errorMessage.textContent = 'Please enter a valid email address.';
            formError.classList.remove('hidden');
          }
          return;
        }

        if (submitBtn) submitBtn.disabled = true;
        if (submitText) submitText.textContent = 'Processing...';
        if (submitSpinner) submitSpinner.classList.remove('hidden');
        if (submitArrow) submitArrow.classList.add('hidden');

        try {
          const eventNames = selectedEvents.map(id => {
            if (id === 'dinner') return 'Mission Brief: Dinner (April 28)';
            if (id === 'breakfast') return 'Mission Brief: Breakfast (April 29)';
            return id;
          }).join(', ');

          const formattedMessage = `RSA Conference 2025 Event Signup\n\nName: ${payload.name}\nOrganization: ${payload.company}\nEmail: ${payload.email}\nSelected Events: ${eventNames}\n\nSubmitted via RSA signup page`;

          const response = await fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              access_key: '217a97ca-0557-4364-86f7-66e28fbd499f',
              subject: `RSA 2025 Event Signup - ${payload.name} (${payload.company})`,
              from_name: payload.name,
              email: payload.email,
              replyto: payload.email,
              message: formattedMessage,
            }),
          });

          const result = await response.json();
          if (response.ok && result.success) {
            if (formSuccess) formSuccess.classList.remove('hidden');
            form.reset();
            formSuccess?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          } else {
            if (formError && errorMessage) {
              errorMessage.textContent = result.message || 'Submission failed. Please try again.';
              formError.classList.remove('hidden');
            }
          }
        } catch (error) {
          if (formError && errorMessage) {
            errorMessage.textContent = 'Network error. Please check your connection.';
            formError.classList.remove('hidden');
          }
        } finally {
          if (submitBtn) submitBtn.disabled = false;
          if (submitText) submitText.textContent = 'Submit Request';
          if (submitSpinner) submitSpinner.classList.add('hidden');
          if (submitArrow) submitArrow.classList.remove('hidden');
        }
      });
    }
  </script>
</Layout>
