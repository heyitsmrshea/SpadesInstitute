---
import Layout from '../components/Layout.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const siteUrl = import.meta.env.PUBLIC_SITE_URL || 'https://www.spadesinstitute.org';
---
<Layout 
  title="Ethics Letter Generator | Spades Institute" 
  description="Generate a pre-filled ethics disclosure form for government employees to submit with volunteer or engagement requests."
>
  <head slot="head">
    <link rel="canonical" href={`${siteUrl}${base}/ethics-letter/`} />
  </head>
  
  <Breadcrumbs items={[
    { label: 'Home', href: `${base}/` },
    { label: 'Ethics Letter', href: `${base}/ethics-letter/` }
  ]} />

  <!-- Hero -->
  <section class="bg-spades-ink-deep section-padding-sm relative overflow-hidden">
    <div class="absolute inset-0 bg-hex-pattern opacity-30" aria-hidden="true"></div>
    
    <div class="max-w-4xl mx-auto px-6 text-center relative blur-reveal">
      <p class="text-xs uppercase tracking-widest text-spades-muted-light mb-4">For Government Employees</p>
      <h1 class="text-heading-xl md:text-heading-2xl text-white">Ethics Letter Generator</h1>
      <p class="mt-4 text-lg text-dark-secondary max-w-2xl mx-auto leading-relaxed">
        Generate a pre-filled ethics disclosure form to submit with your volunteer or engagement request.
      </p>
    </div>
  </section>

  <!-- Generator Form -->
  <section class="bg-spades-paper section-padding">
    <div class="max-w-xl mx-auto px-6">
      <div class="card p-8 md:p-10">
        <form id="ethicsForm" class="space-y-5" novalidate>
          <label class="block">
            <span class="text-sm font-medium text-spades-text mb-2 block">Full Name <span class="text-red-500">*</span></span>
            <input 
              name="fullName" 
              required 
              placeholder="John Smith"
              class="w-full rounded-lg border border-spades-border px-4 py-3 bg-white text-spades-text placeholder-spades-muted focus:outline-none focus:ring-2 focus:ring-spades-accent focus:border-transparent transition-shadow" 
            />
          </label>
          <label class="block">
            <span class="text-sm font-medium text-spades-text mb-2 block">Agency / Department <span class="text-red-500">*</span></span>
            <input 
              name="agency" 
              required 
              placeholder="Department of Defense"
              class="w-full rounded-lg border border-spades-border px-4 py-3 bg-white text-spades-text placeholder-spades-muted focus:outline-none focus:ring-2 focus:ring-spades-accent focus:border-transparent transition-shadow" 
            />
          </label>
          <label class="block">
            <span class="text-sm font-medium text-spades-text mb-2 block">Position / Title <span class="text-red-500">*</span></span>
            <input 
              name="position" 
              required 
              placeholder="Program Manager"
              class="w-full rounded-lg border border-spades-border px-4 py-3 bg-white text-spades-text placeholder-spades-muted focus:outline-none focus:ring-2 focus:ring-spades-accent focus:border-transparent transition-shadow" 
            />
          </label>
          <label class="block">
            <span class="text-sm font-medium text-spades-text mb-2 block">Official Email <span class="text-red-500">*</span></span>
            <input 
              name="email" 
              type="email"
              required 
              placeholder="john.smith@agency.gov"
              class="w-full rounded-lg border border-spades-border px-4 py-3 bg-white text-spades-text placeholder-spades-muted focus:outline-none focus:ring-2 focus:ring-spades-accent focus:border-transparent transition-shadow" 
            />
          </label>
          
          <div class="pt-4">
            <button type="submit" class="btn btn-primary w-full">
              Generate Ethics Letter
              <span aria-hidden="true">↓</span>
            </button>
          </div>
          <p class="text-sm text-spades-muted text-center">
            Opens a printable letter you can save as PDF or print directly.
          </p>
        </form>
      </div>
      
      <!-- What This Is -->
      <div class="mt-8 space-y-6">
        <div class="card p-6">
          <h3 class="font-semibold text-spades-text mb-2">What is this for?</h3>
          <p class="text-sm text-spades-text-secondary">
            Government employees are required to disclose potential conflicts of interest before volunteering with or participating in activities with outside organizations. This tool generates a pre-filled ethics disclosure form you can submit to your agency's ethics official.
          </p>
        </div>
        
        <div class="card p-6">
          <h3 class="font-semibold text-spades-text mb-2">How to use</h3>
          <ol class="text-sm text-spades-text-secondary space-y-2 list-decimal list-inside">
            <li>Fill out the form above with your information</li>
            <li>Click "Generate Ethics Letter" to create your personalized form</li>
            <li>Print or save as PDF using your browser's print dialog</li>
            <li>Submit to your agency's ethics official for approval</li>
          </ol>
        </div>
        
        <div class="card p-6">
          <h3 class="font-semibold text-spades-text mb-2">Questions?</h3>
          <p class="text-sm text-spades-text-secondary">
            Contact us at <a href="mailto:info@spadesinstitute.org" class="text-spades-accent hover:underline">info@spadesinstitute.org</a> if you have questions about the ethics process or need assistance.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="bg-spades-ink-deep section-padding-sm">
    <div class="max-w-4xl mx-auto px-6 text-center">
      <h2 class="text-heading-md text-white mb-4">Ready to Partner?</h2>
      <p class="text-dark-secondary mb-6">Once your ethics form is approved, reach out to discuss how we can collaborate.</p>
      <a href={`${base}/connect/`} class="btn btn-invert">Contact Us</a>
    </div>
  </section>

  <script>
    function initEthicsForm() {
      const ethicsForm = document.getElementById('ethicsForm') as HTMLFormElement;
      if (!ethicsForm) return;
      
      // Remove any existing listeners by cloning the form
      const formClone = ethicsForm.cloneNode(true) as HTMLFormElement;
      ethicsForm.parentNode?.replaceChild(formClone, ethicsForm);
      const form = document.getElementById('ethicsForm') as HTMLFormElement;
      
      if (!form) return;
      
      form.addEventListener('submit', function(event) {
        event.preventDefault();
        event.stopPropagation();
        
        const formData = new FormData(form);
        const fullName = String(formData.get('fullName') || '').trim();
        const agency = String(formData.get('agency') || '').trim();
        const position = String(formData.get('position') || '').trim();
        const email = String(formData.get('email') || '').trim();
        
        // Validation
        if (!fullName || !agency || !position || !email) {
          alert('Please fill in all required fields.');
          return false;
        }
        
        // Validate email format
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          alert('Please enter a valid email address.');
          return false;
        }
        
        const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

        const letterHTML = `
<!DOCTYPE html>
<html>
<head>
  <title>Ethics Disclosure - ${fullName}</title>
  <meta charset="UTF-8">
  <style>
    @page {
      margin: 0.75in;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body { 
      font-family: 'Georgia', 'Times New Roman', serif; 
      max-width: 8.5in; 
      margin: 0 auto; 
      padding: 60px 80px; 
      line-height: 1.7; 
      color: #1a1a1a;
      background: #ffffff;
    }
    .header {
      text-align: center;
      margin-bottom: 50px;
      padding-bottom: 30px;
      border-bottom: 3px solid #1e3a5f;
    }
    .logo {
      font-size: 48px;
      color: #1e3a5f;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .org-name {
      font-size: 28px;
      font-weight: bold;
      color: #1e3a5f;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    .org-subtitle {
      font-size: 12px;
      color: #4b5563;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-top: 5px;
    }
    h1 { 
      font-size: 20px; 
      text-align: center; 
      margin: 40px 0 30px 0; 
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #0f172a;
    }
    .intro {
      font-size: 14px;
      text-align: center;
      color: #374151;
      margin-bottom: 40px;
      padding: 0 20px;
    }
    h2 { 
      font-size: 14px; 
      margin-top: 35px; 
      margin-bottom: 15px; 
      text-transform: uppercase; 
      letter-spacing: 1px;
      font-weight: bold;
      color: #1e3a5f;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 8px;
    }
    .info-grid {
      display: grid;
      grid-template-columns: 180px 1fr;
      gap: 12px 20px;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .info-label { 
      font-weight: bold; 
      color: #374151;
    }
    .info-value {
      color: #111827;
    }
    .cert-list { 
      margin-left: 25px; 
      margin-top: 15px;
    }
    .cert-list li { 
      margin-bottom: 12px; 
      font-size: 14px;
      line-height: 1.8;
      color: #374151;
    }
    .request-type {
      margin: 20px 0;
      font-size: 14px;
    }
    .request-type label {
      margin-right: 30px;
      cursor: pointer;
    }
    .activity-box {
      border: 2px solid #e5e7eb; 
      min-height: 120px; 
      padding: 15px;
      margin-top: 10px;
      background: #fbfbf7;
      font-size: 14px;
      color: #6b7280;
      font-style: italic;
    }
    .signature-block { 
      margin-top: 70px; 
      page-break-inside: avoid;
    }
    .signature-line { 
      border-bottom: 2px solid #1a1a1a; 
      width: 350px; 
      margin: 50px 0 10px 0; 
      height: 50px; 
    }
    .signature-name {
      font-size: 14px;
      font-weight: bold;
      margin-top: 5px;
      color: #111827;
    }
    .signature-date {
      font-size: 14px;
      color: #6b7280;
      margin-top: 5px;
    }
    .note { 
      margin-top: 50px; 
      padding: 20px; 
      background: #f3f4f6; 
      border-left: 4px solid #1e3a5f; 
      font-size: 13px;
      line-height: 1.7;
      color: #374151;
    }
    .note strong {
      color: #1e3a5f;
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
      text-align: center;
      font-size: 11px;
      color: #9ca3af;
    }
    .no-print { 
      display: none;
    }
    @media print { 
      body { 
        margin: 0; 
        padding: 0.75in;
      } 
      .no-print { 
        display: none; 
      }
      .note {
        page-break-inside: avoid;
      }
    }
    @media screen {
      .no-print {
        display: block;
        margin-top: 40px;
        text-align: center;
        padding: 20px;
        background: #f9fafb;
        border-radius: 8px;
      }
      .print-btn {
        padding: 14px 32px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        background: #1e3a5f;
        color: white;
        border: none;
        border-radius: 6px;
        transition: background 0.2s;
      }
      .print-btn:hover {
        background: #0f2a4a;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">♠︎</div>
    <div class="org-name">Spades Institute</div>
    <div class="org-subtitle">501(c)(3) Nonprofit Organization</div>
  </div>
  
  <h1>Ethics Disclosure and Conflict of Interest Statement</h1>
  
  <p class="intro">
    This form is for government employees who wish to volunteer their time or request an engagement with Spades Institute, a 501(c)(3) nonprofit organization dedicated to connecting government, industry, and academia to solve national security priorities through trusted, nonpartisan collaboration.
  </p>
  
  <h2>Employee Information</h2>
  <div class="info-grid">
    <div class="info-label">Name:</div>
    <div class="info-value">${fullName}</div>
    
    <div class="info-label">Agency/Department:</div>
    <div class="info-value">${agency}</div>
    
    <div class="info-label">Position/Title:</div>
    <div class="info-value">${position}</div>
    
    <div class="info-label">Email:</div>
    <div class="info-value">${email}</div>
    
    <div class="info-label">Date:</div>
    <div class="info-value">${today}</div>
  </div>
  
  <h2>Ethics Certification</h2>
  <p style="margin-bottom: 10px; font-size: 14px;">I certify that:</p>
  <ol class="cert-list">
    <li>My participation with Spades Institute is in compliance with all applicable ethics rules and regulations.</li>
    <li>I have reviewed and understand my agency's ethics guidelines regarding outside activities.</li>
    <li>I have disclosed any potential conflicts of interest to my ethics official.</li>
    <li>My participation will not create a conflict of interest or appearance of impropriety.</li>
    <li>I will not use government resources, time, or information for Spades Institute activities.</li>
  </ol>
  
  <h2>Request Type</h2>
  <div class="request-type">
    <label>☐ Volunteer Time</label>
    <label>☐ Request Engagement</label>
  </div>
  
  <h2>Description of Proposed Activity</h2>
  <div class="activity-box">
    [Please describe your proposed volunteer work or engagement request here]
  </div>
  
  <div class="signature-block">
    <h2>Signature</h2>
    <div class="signature-line"></div>
    <div class="signature-name">${fullName}</div>
    <div class="signature-date">${today}</div>
  </div>
  
  <div class="note">
    <strong>IMPORTANT:</strong> Please print this document and submit it to your ethics official for approval before proceeding with Spades Institute activities. For questions or assistance, contact info@spadesinstitute.org.
  </div>
  
  <div class="footer">
    Spades Institute · EIN 99-2763425 · Washington DC<br>
    www.spadesinstitute.org · info@spadesinstitute.org
  </div>
  
  <div class="no-print">
    <button class="print-btn" onclick="window.print()">Print / Save as PDF</button>
    <p style="margin-top: 15px; font-size: 14px; color: #6b7280;">
      Use your browser's print dialog to save as PDF or print directly.
    </p>
  </div>
</body>
</html>`;

        const printWindow = window.open('', '_blank');
        if (printWindow) {
          printWindow.document.write(letterHTML);
          printWindow.document.close();
        } else {
          alert('Please allow pop-ups for this site to generate the ethics letter.');
        }
        return false;
      });
    }
    
    // Initialize when DOM is ready
    function setupEthicsForm() {
      initEthicsForm();
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupEthicsForm);
    } else {
      setupEthicsForm();
    }
    
    // Re-initialize after Astro view transitions
    document.addEventListener('astro:page-load', setupEthicsForm);
  </script>
</Layout>
